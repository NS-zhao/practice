<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        body {
            background-image: url("./img/4.png");
            background-size: cover;
        }

        .box {
            position: relative;
            top: 50%;
            transform: translatey(-50%);
            margin: 0 auto;
            width: 1000px;
            height: 600px;
            box-shadow: 0 0 5px #666;
            border-radius: 6px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .title {
            width: 1000px;
            height: 60px;
            background-color: #7c1823;
            display: flex;
            align-items: center;
        }

        .title > span {
            font-size: 20px;
            color: #fff;
            font-weight: 700;
            display: inline-block;
            width: 200px;
            float: left;
            text-align: center;
            line-height: 60px;
        }

        .search {
            overflow: hidden;
            position: relative;
            width: 260px;
            height: 30px;
            border: 1px solid #666666;
            border-radius: 50px;
            display: flex;
        }

        .search > input {
            width: 250px;
            line-height: 30px;
            outline: none;
            border: none;
            padding-left: 10px;
        }

        .title > button {
            width: 80px;
            line-height: 30px;
            margin-left: 20px;
            border-radius: 30px;
            outline: none;
            border: none;
            background-color: #c5345c;
            color: #fff;
            font-size: 16px;
        }

        .title > button:active {
            background-color: #ca5fde;
        }

        .audio-info {
            width: 1000px;
            height: 470px;
            background-color: rgba(255, 255, 255, 0.57);
        }

        .audio-list, .audio-msg {
            height: 470px;
        }

        .audio-list {
            float: left;
            width: 200px;
        }

        .audio-msg {
            width: 300px;
            float: right;
        }

        .audio-animte {
            position: relative;
            height: 470px;
            overflow: hidden;
        }

        .audio-animte:before {
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 1px;
            height: 370px;
            background: linear-gradient(rgba(255, 255, 255, 0.37), #666, rgba(255, 255, 255, 0.37));
        }

        .audio-animte:after {
            content: "";
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 1px;
            height: 370px;
            background: linear-gradient(rgba(255, 255, 255, 0.37), #666, rgba(255, 255, 255, 0.37));
        }

        .audio-msg > h4 {
            text-align: center;
            line-height: 40px;
            font-weight: 700;
            color: #7c1823;
        }

        .contral {
            width: 1000px;
            height: 70px;
            background-color: #eaeaea;
            display: flex;
            align-items: center;
        }

        .contral > audio {
            width: 1000px;
        }

        #menu, #comment {
            overflow-y: scroll;
            height: 470px;
        }

        #menu::-webkit-scrollbar, #comment::-webkit-scrollbar {
            display: none;
        }

        #menu > li {
            line-height: 30px;
            border-radius: 5px;
            background-color: #fff;
            display: flex;
            margin: 2px 5px;
            align-items: center;
            padding: 0 10px;
        }

        #menu > li span {
            display: inline-block;
            width: 130px;
            text-align: left;
            font-size: 13px;
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
            margin-left: 15px;
        }

        #menu > li i {
            display: inline-block;
            width: 16px;
            height: 16px;
        }

        #menu > li i.play {
            background-image: url("./img/play.png");
            background-size: cover;
        }

        #menu > li i.mv {
            background-image: url("./img/MV.png");
            background-size: cover;
        }

        #comment li {
            line-height: 30px;
            border-radius: 5px;
            background-color: #fff;
            display: flex;
            margin: 2px 5px;
            align-items: center;
            padding: 0 10px;
            white-space: nowrap;
            font-size: 13px;
        }

        #comment li span:first-child {
            width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;

        }

        .img {
            position: absolute;
            z-index: 0;
            left: 50%;
            top: 50%;
            margin-top: -100px;
            margin-left: -100px;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            overflow: hidden;
        }

        .img > img {
            width: 100%;
            height: 100%;
        }

        .dis {
            position: absolute;
            z-index: 1;
            left: 50%;
            top: 50%;
            margin-top: -100px;
            margin-left: -100px;
            width: 200px;
            height: 200px;
            background-image: url("./img/disc.e89e0c3.png");
            background-size: cover;
            transform-origin: 50% 50%;
        }

        .rotate {
            animation: rotatez 15s .3s linear infinite;
        }

        @keyframes rotatez {
            from {
                transform: rotatez(0deg);
            }
            to {
                transform: rotatez(360deg);
            }
        }

        .animte {
            position: absolute;
            left: 70%;
            top: 20%;
            z-index: 2;
            width: 80px;
            height: 120px;
            background-image: url("./img/player_bar.3b9b552.png");
            background-size: 100% 100%;
            transform-origin: 10px 10px;
            transition: all .3s ease;
        }

        .trans {
            transform: rotatez(50deg);
        }

        .name {
            position: absolute;
            top: 10%;
            z-index: 2;
            width: 100%;
            height: 40px;
            font-weight: 700;
            color: #000;
            text-align: center;
        }

        .mvvideo {
            position: absolute;
            left: 0;
            top: 0;
            z-index: 5;
            width: 1000px;
            height: 600px;
        }
        .hide {
            display: none;
        }
        .mvvideo > video {
            position:relative;
            width: 1000px;
            height: 600px;
        }
        .close{
            position: absolute;
            color: #fff;
            font-size: 13px;
            left: 10px;
            top: 10px;
            z-index: 10;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="box">
    <div class="title">
        <span>音乐播放器</span>

        <div class="search">
            <input type="text" id="searchText" placeholder="请输入歌曲关键字"/>
        </div>
        <button id="btnsearch">搜索</button>
    </div>
    <div class="audio-info">
        <div class="audio-list">
            <ul id="menu"></ul>
        </div>
        <div class="audio-msg">
            <h4>热门评论</h4>
            <ul id="comment"></ul>
        </div>
        <div class="audio-animte">
            <div class="name" id="musicname"></div>
            <div class="animte" id="aninfo"></div>
            <div class="img"><img id="userinfo" src="" alt=""/></div>
            <div class="dis" id="disinfo"></div>
        </div>
    </div>
    <div class="contral">
        <audio id="audio" controls></audio>
    </div>
    <div class="mvvideo hide" id="mvitem">
        <span class="close" id="closebtn">关闭</span>
        <video id="videoitem"></video>
    </div>
</div>
<script>
    var playList,mvlist;
    //  搜索歌曲api https://autumnfish.cn/search?keywords=小龙虾
    //根据歌曲的id号获取相关信息  api https://autumnfish.cn/song/url?id=
    //https://autumnfish.cn/song/detail?ids=   详细信息
    //https://autumnfish.cn/comment/hot?type=0&id=  热度api
    //https://autumnfish.cn/mv/url?id=  获取当前歌曲的mv
    function Ajax(method,url,data,callback){
        var http;
        if(window.XMLHttpRequest){
            http=new XMLHttpRequest();
        }
        else{
            http=new ActiveXObject("Microsoft.XMLHTTP");
        }
        if(method=="get"){
            if(data){
                url+="?";
                url+=data;
            }
            http.open(method,url);
            http.send();
        }
        else{
            http.open(method,url);
            if(data){
                http.send(data);
            }
            else{
                http.send();
            }
        }
        http.onreadystatechange=function(){
            if(http.readyState==4&&http.status==200){
                callback(http.response);
            }
        }
    }
    //点击搜索
    btnsearch.onclick=function(){
        //检测value值
        var value=searchText.value.replace(/\s/g,'');
        if(value){
            searchMusic(value);
            searchText.value = "";
        }
        else{
            alert("请输入关键字！");
        }
    }
    closebtn.onclick=function(){
        videoitem.src="";
        mvitem.classList.add("hide");
    }
    //获取搜索相关搜索歌曲
    function searchMusic(music){
        var src="https://autumnfish.cn/search";
        Ajax('get',src,"keywords="+music,function(res){
            console.log(JSON.parse(res));
            //数据循环渲染
            var str="";
            var song=JSON.parse(res).result.songs;
            for(var i=0;i<song.length;i++){
                str+="<li><i class='play' data-id='"+song[i].id+"'></i><span>"+song[i].name+"</span>"+(song[i].mvid!=0?'<i class="mv" data-mv="'+song[i].mvid+'"></i>':'') + "</li>";
            }
            menu.innerHTML=str;
            //赋值完成之后才有开始元素
            playList=document.getElementsByClassName("play");
            mvlist=document.getElementsByClassName("mv");
            addPlayHandle();
            addMv();
        });
    }
    //给所有的play添加事件
    function addPlayHandle(){
        let url="https://autumnfish.cn/song/url";
        let detailurl = "https://autumnfish.cn/song/detail";
        let chaturl = "https://autumnfish.cn/comment/hot";
        for(var i=0;i<playList.length;i++){
            playList[i].onclick=function(){
                disinfo.classList.add("rotate");
                aninfo.classList.add("trans");
                var id=this.getAttribute("data-id");
                //获取当前歌曲路径
                Ajax('get',url,"id="+id,function(res){
                    //console.log(JSON.parse(res));
                    var respon=JSON.parse(res);
                    //设置audio
                    audio.src=respon.data[0].url;
                    audio.play();
                });
                //获取歌曲详情
                Ajax('get',detailurl,"ids="+id,function(res){
                    console.log(JSON.parse(res));
                    var respon=JSON.parse(res);
                    var obj=respon.songs[0].al;
                    musicname.innerText=respon.songs[0].name;
                    userinfo.src=obj.picUrl;
                });
                //获取歌曲的评论
                Ajax('get',chaturl,"type=0&id="+id,function(res){
                    //console.log(JSON.parse(res));
                    var respon=JSON.parse(res);
                    addComment(respon.hotComments);
                });
            }
        }
    }
    //绑定当前歌曲的评论
    function addComment(comm){
        var str="";
        var time=new Date();
        for(var i=0;i<comm.length;i++){
            time.setTime(comm[i].time);
            str+="<li><span>"+comm[i].content+"</span><span>"+time.toLocaleString()+"</span></li>";
        }
        comment.innerHTML=str;
    }
    //给所有的mv添加事件
    function addMv(){
        let src="https://autumnfish.cn/mv/url";
        for(var i=0;i<mvlist.length;i++){
            mvlist[i].onclick=function(){
                var mvid=this.getAttribute("data-mv");
                Ajax('get',src,"id="+mvid,function(res){
                    var respon=JSON.parse(res);
                    mvitem.classList.remove("hide");
                    videoitem.src=respon.data.url;
                    videoitem.play();
                });
            }
        }
    }
</script>
</body>
</html>