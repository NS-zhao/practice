<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <style>
        *{
            padding: 0;
            margin: 0;
        }
        .map{
            position: relative;
            margin: 0 auto;
        }
        .snack{
            position: absolute;
        }
        .food{
            position: absolute;

        }
    </style>
</head>
<body>
<script>
    //1.创建地图实例---当地图不存在的时候，创建地图--把地图追加到body里面--加载地图，加载完成后实例化这个地图对象
    //2.创建蛇的实例---创建蛇---如果蛇元素不存在，创建蛇元素；若是蛇元素存在，直接修改坐标--将创建的蛇添加到地图里面---加载蛇，加载完成后实例化蛇这个对象
    //3.设置蛇移动，创建一个计时器，设置一个速度，再设置蛇移动的默认方向---蛇头根据方向来变
    //4.根据按键设置蛇移动--设置长按键加速
    //5.移动过后，检测是否可以穿墙（只管蛇头）
    //6.创建食物实例---创建食物方法--随机使用坐标--如果食物不存在，创建一个食物--如果食物存在，直接随机坐标就可以--将食物添加到地图上--实例化创建食物--
       //检测食物坐标（食物不能设置在蛇身上）
    //检测蛇头是否吃到食物
    var map,snack,food;
    //1.创建地图实例
    function Map(){
        this.width = 900;
        this.height = 600;
        this.bgcolor = "#000";
        //设置蛇移动的速度
        this.speed = 500;
        this._map = null;//存储地图的dom元素
        this.timer = null;
        //重置计时器的方法
        this.resetTimer = function()
        {
            var that = this;
            if(that.timer)
            {
                clearInterval(that.timer);
            }
            that.timer = setInterval('snack.move()',that.speed);
        }
        this.createMap = function () {
            if(this._map == null)//即地图不存在的时候
            {
                //创建地图
                this._map = document.createElement("div");
                this._map.style.width = this.width+"px";
                this._map.style.height = this.height+"px";
                this._map.style.backgroundColor = this.bgcolor;
                this._map.classList.add("map");
                document.body.appendChild(this._map);//把地图追加到body里面
            }
        }
    }
    //2.创建蛇的实例
    function Snack(){
        this.w = 30;
        this.h = 30;
        //[蛇头颜色，蛇头，蛇头坐标],[蛇身颜色，蛇身，蛇身坐标],[蛇身颜色，蛇身，蛇身坐标]
        this._snack = [['red',null,3,1],['#fff',null,2,1],['#fff',null,1,1]];
        //设置蛇的方向属性
        this.direction = "right";
        //创建蛇
        this.createSnack = function(){
            for(var i = 0;i<this._snack.length;i++)
            {
                //如果蛇元素不存在
                if(this._snack[i][1] == null)
                {
                    //创建蛇元素
                    this._snack[i][1] = document.createElement("div");
                    this._snack[i][1].style.width = this.w+"px";
                    this._snack[i][1].style.height = this.h+"px";
                    this._snack[i][1].style.backgroundColor = this._snack[i][0];
                    this._snack[i][1].classList.add("snack");
                    //将创建的蛇添加到地图里面
                    map._map.appendChild(this._snack[i][1]);
                }
                //若是蛇元素存在，直接修改坐标
                this._snack[i][1].style.left = this.w*this._snack[i][2]+"px";
                this._snack[i][1].style.top = this.h*this._snack[i][3]+"px";
            }
        }
        //设置蛇移动
        this.move = function(){
            //蛇是从后往前动，获取前面一节的坐标
            var len = this._snack.length-1;
            for(var i = len;i>0;i--)
            {
                this._snack[i][2] = this._snack[i-1][2];
                this._snack[i][3] = this._snack[i-1][3];
            }
            //蛇头根据方向来变
            switch (this.direction){
                case "left":
                    this._snack[0][2]-=1;
                    break;
                case "right":
                    this._snack[0][2]+=1;
                    break;
                case "up":
                    this._snack[0][3]-=1;
                    break;
                case "down":
                    this._snack[0][3]+=1;
                    break;
            }

            //检测蛇头是否吃到食物
            this.iseatfood();
            this.goqiang();
            //让界面元素都发生变化
            this.createSnack();
        };
        this.iseatfood() = function{
            if(this._snack[0][2] == food.x&&this._snack[0][3] == food.y)
            {
                //蛇增加一节，食物重新随机位置
                //蛇最后一节增加的坐标
                var len = this._snack.length-1;
                var x = this._snack[len][2];
                var y = this._snack[len][3];
                this._snack.push(['#fff',null,1,1]);
                //食物重新随机位置
                food.createFood();
            }
        }
        //移动之后，检测是否可以穿墙
        this.goqiang = function(){
            if(this._snack[0][2]>29){
                this._snack[0][2] = 0;
            }
            if(this._snack[0][2]<0){
                this._snack[0][2] = 29;
            }
            if(this._snack[0][3]>19){
                this._snack[0][3] = 0;
            }
            if(this._snack[0][3]<0){
                this._snack[0][3] = 19;
            }
        }

    }



    //6.创建食物实例
    function Food(){
        this.w = 30;
        this.h = 30;
        this.fcolor = "pink";
        this.x;
        this.y;
        this._food = null;//保留食物当前对象
        //检测食物坐标（食物不能设置在蛇身上）
        this.checkPos = function(){
            var iswhile = false;//表示开关
            do{
                //随机使用坐标
                this.x = Math.floor(Math.random()*30);
                this.y = Math.floor(Math.random()*20);
                var ishas = false;//检测坐标中是否有相等的
                //检测坐标
                for(var i = 0;i<snack._snack.length;i++)
                {
                    if(snack._snack[i][2] == this.x&&snack._snack[i][3] == this.y)
                    {
                        //如果坐标一样，需要重新随机，直到坐标不一样
                        ishas = true;
                        break;
                    }
                }
                if(ishas)
                {
                    iswhile = true;
                }
                else{
                    iswhile = false;
                }
            }
            while(iswhile)
        }
        //创建食物方法
        this.createFood = function(){
            //检测坐标
            this.checkPos();

            //如果食物不存在，创建一个食物
            if(this._food == null){
                this._food = document.createElement("div");
                this._food.style.width = this.w+"px";
                this._food.style.height = this.h+"px";
                this._food.style.backgroundColor = this.fcolor;
                this._food.classList.add("food");
                //将食物添加到地图上
                map._map.appendChild(this._food);
            }
            //如果食物存在，直接随机坐标就可以
            this._food.style.left = this.x*this.w+"px";
            this._food.style.top = this.y*this.h+"px";
        }

    }

    window.onload = function () {
        //加载地图，加载完成后实例化地图这个对象
        map = new Map();
        map.createMap();
        //加载蛇，加载完成后实例化蛇这个对象
        snack = new Snack();
        snack.createSnack();
        //直接在计时器里面写snack.move,this指向的是window，length会报错
        //timer = setInterval(snack.move,map.speed);
        //设置计时
        map.resetTimer();

        //实例化创建食物
        food = new Food();
        food.createFood();
        //添加键盘事件
        document.body.onkeyup = function(e){
            checkWay(e);
            if(keyCode)
            {
                keyCode = null;
                map.speed = 800;
                map.resetTimer();
                lianxu = false;
            }
        }
        //用变量接收你按键的键值
        var keyCode = null;
        var lianxu = false;
        document.body.onkeydown = function(e){
            var key = e.key;
            if(key == "ArrowLeft"||key == "ArrowRight"||key == "ArrowUp"||key == "ArrowDown")
            {
                if(keyCode == key&&lianxu == false)
                {
                    lianxu = true;
                    checkWay(e);
                    map.speed = 100;
                    map.resetTimer();
                }
            }
            keyCode = key;
        }
        //检测方向的方法
        function checkWay(e){
            switch (e.key){
                case "ArrowLeft":
                    if(snack.direction!='right'){
                        snack.direction = "left";
                        break;
                    }
                case "ArrowRight":
                    if(snack.direction!='left'){
                        snack.direction = "right";
                        break;
                    }
                case "ArrowUp":
                    if(snack.direction!='down'){
                        snack.direction = "up";
                        break;
                    }
                case "ArrowDown":
                    if(snack.direction!='up'){
                        snack.direction = "down";
                        break;
                    }
            }
        }
    }
</script>
</body>

</html>