<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<script>
    //目标者类
    //存储所有的观察者
    //存在以下功能，存储、添加、删除、通知、修改观察者
    var Subject = {
        observes:[],//存储所有的观察者列表
        //添加方法
        add:function(observe){
            this.observes.push(observe);
        },
        //删除方法
        remove:function(observe){
            var index = this.observes.findIndex(function(item){
                return item === observe;
            });
            this.observes.splice(index,1);
        },
        //通知方法
        send:function(){
            for(index in this.observes)
            {
                this.observes[index].update();
            }
        },

    }
    //多个列表类
    function Observer(name){
        this.subscribes = {};//添加当前这个人的订阅信息
        this.name = name;
        this.update = function(){
            console.log("当前目标者通知更新",this.name);
        };
        //添加订阅方法
        this.subscribe = function(key,fn){//key--订阅的属性，fn--订阅的方法
            if(!this.subscribes[key])
            {
                this.subscribes[key] = [];
            }
            this.subscribes[key].push(fn);
        }
        //发布订阅
        this.publish = function(key){
            for(var index in this.subscribes[key])
            {
                this.subscribes[key][index].call(this);
            }
        }
    }
    //实例化观察者
    var ob1 = new Observer("张三");
    var ob2 = new Observer("李四");
    //添加目标观察者到观察者列表
    Subject.add(ob1);
    Subject.add(ob2);
    //发送
    Subject.send();
    //删除
    Subject.remove(ob2);
    //发送
    Subject.send();
    //张三订阅消息
    ob1.subscribe("message",function(){
        console.log(this.name + "订阅消息");
    });
    console.log(ob1.subscribes);
    //发布
    ob1.publish("message");



    document.body.addEventListener("click",handle);
    function handle(){
        console.log(1);
    }
    document.body.removeEventListener("click",handle);
    document.body.click();
</script>
</body>
</html>