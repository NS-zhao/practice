clc;
clear;

B=[5 33;8 9;10 24;13 34;17 23;20 10;25 47;31 18;35 42;36 25;41 31;45 38;     %12个一级供水站V
    41 35;40 34;38 35;38 37;33 37;31 36;33 35;28 32;24 30;21 31;22 27;28 29;43 37;44 39;25 27;21 29;22 30;24 32;37 33;38 33;37 36;14 13;     %168个二级供水站P
    16 9;14 7;18 14;12 6;15 14;20 13;13 46;16 39;21 39;26 44;28 40;27 42;29 38;29 44;36 44;41 40;39 52;27 49;23 46;20 46;16 46;22 44;40 44;
    42 40;37 42;35 49;35 51;35 52;34 55;26 53;27 51;31 51;31 45;31 41;28 45;27 35;24 38;26 39;13 37;17 36;21 41;18 41;21 43;13 39;14 43;12 43;
    10 44;16 44;18 44;24 44;25 49;24 49;24 51;21 48;17 51;10 34;9 35;7 37;4 37;5 42;2 44;7 32;7 30;1 24;2 16;3 18;2 20;4 24;5 28;6 24;9 29;2 33;7 34;
    3 30;3 41;10 36;17 34;20 22;24 21;22 17;21 16;27 19;26 16;9 16;12 17;14 15;19 26;14 28;13 25;9 19;2 1;6 6;7 8;6 14;5 17;5 16;16 19;26 13;29 11;
    31 14;28 17;20 19;17 22;15 23;21 23;24 23;26 23;25 25;15 31;15 29;10 28;38 26;37 25;33 21;40 24;44 44;41 31;33 24;32 27;40 14;42 26;45 33;
    29 23;31 30;30 25;31 23;35 15;40 16;40 20;37 20;35 24;43 23;45 26;37 28;35 28;33 29;37 30;39 30;41 29;43 31;47 34;46 43;42 43;48 45;42 44;43 50];

C=[ 
      5 33;8 9;10 24;13 34;17 23;20 10;25 47;31 18;35 42;36 25;41 31;45 38;     %12个一级供水站V
      41 35;40 34;38 35;38 37;33 37;31 36;33 35;28 32;24 30;21 31;22 27;28 29;43 37;44 39;25 27;21 29;22 30;24 32;37 33;38 33;37 36;14 13;     %168个二级供水站P
      16 9;14 7;18 14;12 6;15 14;20 13;13 46;16 39;21 39;26 44;28 40;27 42;29 38;29 44;36 44;41 40;39 52;27 49;23 46;20 46;16 46;22 44;40 44;
      42 40;37 42;35 49;35 51;35 52;34 55;26 53;27 51;31 51;31 45;31 41;28 45;27 35;24 38;26 39;13 37;17 36;21 41;18 41;21 43;13 39;14 43;12 43;
      10 44;16 44;18 44;24 44;25 49;24 49;24 51;21 48;17 51;10 34;9 35;7 37;4 37;5 42;2 44;7 32;7 30;1 24;2 16;3 18;2 20;4 24;5 28;6 24;9 29;2 33;7 34;
      3 30;3 41;10 36;17 34;20 22;24 21;22 17;21 16;27 19;26 16;9 16;12 17;14 15;19 26;14 28;13 25;9 19;2 1;6 6;7 8;6 14;5 17;5 16;16 19;26 13;29 11;
      31 14;28 17;20 19;17 22;15 23;21 23;24 23;26 23;25 25;15 31;15 29;10 28;38 26;37 25;33 21;40 24;44 44;41 31;33 24;32 27;40 14;42 26;45 33;
      29 23;31 30;30 25;31 23;35 15;40 16;40 20;37 20;35 24;43 23;45 26;37 28;35 28;33 29;37 30;39 30;41 29;43 31;47 34;46 43;42 43;48 45;42 44;43 50];

n=length(B);      %n=180
a=zeros(180);    %带权邻接矩阵
b=zeros(180);    %无权邻接矩阵

for i=1:n
    for j=i+1:n
        a(i,j)=sqrt(sum((B(i,:)-B(j,:)).^2));   %一级与二级，二级之间距离
        a(j,i)=sqrt(sum((B(i,:)-B(j,:)).^2));   %二级供水站之间距离
    end
end

total=0;      %管道总里程数
a(find(a==0))=inf;    %prim算法
result=[];p=1;tb=2:length(a);
while length(result)~=length(a)-1
    temp=a(p,tb);temp=temp(:);
    d=min(temp);
    total=total+d;
    [jb,kb]=find(a(p,tb)==d);
    j=p(jb(1));k=tb(kb(1));
    b(j,k)=1;
    b(k,j)=1;
    result=[result,[j;k;d]];
    p=[p,k];
    tb(find(tb==k))=[];
end
result
total

A1=[26];         %中心供水站x坐标
A2=[31];         %中心拱水站y坐标

V1=[5 8 10 13 17 20 25 31 35 36 41 45 ];       %一级供水站x坐标
V2=[33 9 24 34 23 10 47 18 42 25 31 38];      %一级供水站y坐标

P1=[41 40 38 38 33 31 33 28 24 21 22 28 43 44 25 21 22 24 37 38 37 14 16 14 18 12 15 20 13 16 21 26 28 27 29 29 36 41 39 27 23 20 16 22 40 42 37 35 35 35 34 26 27 31 31 31 28 27 24 26 13 17 21 18 21 13 14 12 10 16 18 24 25 24 24 21 17 10 9 7 4 5 2 7 7 1 2 3 2 4 5 6 9 2 7 3 3 10 17 20 24 22 21 27 26 9 12 14 19 14 13 9 2 6 7 6 5 5 16 26 29 31 28 20 17 15 21 24 26 25 15 15 10 38 37 33 40 44 41 33 32 40 42 45 29 31 30 31 35 40 40 37 35 43 45 37 35 33 37 39 41 43 47 46 42 48 42 43];                  %二级供水站x坐标

P2=[35 34 35 37 37 36 35 32 30 31 27 29 37 39 27 29 30 32 33 33 36 13 9 7 14 6 14 13 46 39 39 44 40 42 38 44 44 40 52 49 46 46 46 44 44 40 42 49 51 52 55 53 51 51 45 41 45 35 38 39 37 36 41 41 43 39 43 43 44 44 44 44 49 49 51 48 51 34 35 37 37 42 44 32 30 24 16 18 20 24 28 24 29 33 34 30 41 36 34 22 21 17 16 19 16 16 17 15 26 28 25 19 1 6 8 14 17 16 19 13 11 14 17 19 22 23 23 23 23 25 31 29 28 26 25 21 24 44 31 24 27 14 26 33 23 30 25 23 15 16 20 20 24 23 26 28 28 29 30 30 29 31 34 43 43 45 44 50];               %二级供水站y坐标

% 二级供应点
plot(P1,P2,'.');
hold on

%一级供应点
plot(V1,V2,'*');
hold on
% 标点
for i=1:12
   v=num2str(i);
   v=[' V',v];
   text(V1(i),V2(i),v,'FontSize',6);
end

hold on;
%中心供应点
plot(26,31,'p','LineWidth',3);

xlabel('x')
ylabel('y')

gplot(b,C,'r-')

hold on
m1= [
    26
    5
8
10
13
17
20
25
31
35
36
41
45];

n1=[
    31
    33
9
24
34
23
10
47
18
42
25
31
38];

B =[11 5 7 2 5 4 6 8 11 8 12 13 10];
for i=1:13
    x=[m1(i),m1(B(i))];
    y=[n1(i),n1(B(i))];
    plot(x,y,'k');
    hold on;
end
x=[26,17];
y=[31,23];
plot(x,y,'k');


legend('二级供水站','一级供水站','中心供水站','一级到二级和二级之间','中心到一级和一级之间','Location','NorthEastOutside');
